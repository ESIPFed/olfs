<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
<title>Untitled Document</title>
<style type="text/css">
<!--
.style1 {
	font-family: "Courier New", Courier, mono;
	font-size: 14px;
}
-->
</style>
</head>

<body>
<h1 align="center"><a href="http://www.opendap.org"><img src="images/opendap_logo_masthead.gif" alt="OPeNDAP Logo" width="206" height="93" border="0" /></a><br />
Building and Installing <br />
Server4</h1>
<h3 align="center">version: beta-1.3 </h3>
<hr />
<p><em>(Note: Releases 1.0 to 1.3 are alpha releases of server4 and assume that <br />
  the builder is familar with OPeNDAP software. Release 1.4 will be a beta <br />
release.</em>)</p>
<p>There are two different components to server4, each of which must be built and installed to get a running server. See the README file for information on the server architecture and roles of the two parts of the server.</p>
<p>What you will need:</p>
<ul>
  <li>  30 minutes</li>
  <li>A <a href="http://subversion.tigris.org/">Subversion</a> client</li>
  <li>C++ compiler</li>
  <li>Java 1.4 or 1.5 Runtime or Development Environment</li>
  <li><a href="http://tomcat.apache.org/">Tomcat 4.1.x or 5.5.x</a> </li>
  <li>Data (netcdf files for version 1.0 of this software)</li>
  <li>A web browser</li>
</ul>
<h2>&nbsp;</h2>
<h2>Part I: Download, and install the OPeNDAP DAP library.</h2>
<h2>&nbsp;</h2>
<h2>Part II: Download, build, configure and test the BES</h2>
<p>The BES software is contained in Subversion in the project 'bes.' Get this using <a href="http://scm.opendap.org:8090/svn/trunk/bes">http://scm.opendap.org:8090/svn/trunk/bes</a>. Once you have the software,
  perform the usual autoreconf, configure, make and 'make install' steps to build 
the code. This will install libraries needed by the server daemon.</p>
<p>To build the server daemon itself, check out the netcdf_handler project 
  from subversion: <a href="http://scm.opendap.org:8090/svn/trunk/netcdf_handler">http://scm.opendap.org:8090/svn/trunk/netcdf_handler</a>. Again,
  use autoreconf to generate the configure and Makefile.in files. However, when
  you run configure, make sure to use the --with-bes option, passing it the 
  installation prefix of the bes software. Assuming you built the bes using the<br />
  default prefix, configure should be run as './configure --with-bes=/usr/local'.
  The configure script is not too smart about where to look for the bes libraries
  and, if it cannot find them, it won't build the bes server daemon. After 
running configure, run make; there's no need to run 'make install'.</p>
<p>You should see two executables in the netcdf_handler directory at this point,
  dap_nc_handler and opendapserver. The latter is the bes daemon (ignore
dap_nc_handler).</p>
<p>To run the daemon, you will need an configuration file. Look at the file 
  named opendap.ini and edit its values to suit your system (note that as of
  2/3/06 the bes only knows how to serve netCDF files). Most of the paths/values
  in the sample file should be fine. Make sure 'Catalog.catalog.RootDirectory'<br />
is the full path to the root of the data you want to serve.</p>
<h3>Part IIb: Configure the <em>besd</em> daemon</h3>
<p>Configuration instructions for the besd daemon is included with the BES distribution. Note that because the BES and OLFS communicate via sockets they  <strong>both</strong> need to know which  socket. By default the OLFS will look for the BES on the same machine (via the loop back address 127.0.0.1) on port 10002. You may change this in the <a href="servlet.html">OLFS configuration</a>. </p>
<h3>Part IIc: Start the <em>besd</em> daemon.</h3>
<p>Again, follow the instructions bundled with the BES to start it up. </p>
<h3>Part IId: Test the opendapserver daemon</h3>
<p>Again, follow the instructions bundled with the BES to test it. </p>
<p>&nbsp;</p>
<h2>Part III: Setting up the OLFS</h2>
<p>Check out the software for Server4 found at <a href="http://scm.opendap.org:8090/svn/trunk/Server4">http://scm.opendap.org:8090/svn/trunk/Server4</a>. </p>
<p>Change directory to Server4 and
  build the code by issuing the command:</p>
<blockquote>
  <p class="style1">ant -f buildfiles/s4.xml server</p>
</blockquote>
<p>I used ant version 1.6.2
  with Java 1.5.0_06-112. I had to edit the shell script 'ant' and replace '-cp' with
  '-lib'. This is a known issue with these two versions. If you're using Java 1.4
  you should not have to modify the ant script.</p>
<p>Once built, copy the opendap.war file into the Tomcat Web Apps directory:</p>
<blockquote>
  <p class="style1"> cp build/dist/opendap.war /usr/local/apache-tomcat-5.5.15/webapps/</p>
</blockquote>
<p>If you're replacing an old copy, make sure that remove the 'opendap' directory 
that Tomcat will have created when it was started. </p>
<p>Configure the Tomcat environment by setting the environment variable CATALINA_HOME to the full
path for the Tomcat distribution.<br />
<br />
In bash:</p>
<blockquote>
  <p class="style1">export CATALINA_HOME =
    /usr/local/apache-tomcat-5.5.15</p>
</blockquote>
<p> In the top level tomcat directory
    (jakarta-tomcat-4.1.31 on my machine) issue the command: </p>
<blockquote>
  <p class="style1"> bin/startup.sh; tail -f logs/catalina.out</p>
</blockquote>
<p>  Wait a few seconds while it all starts up.</p>
<p>&nbsp;</p>
<h3>Part IIIb: Configure the OLFS servlet.</h3>
<p><a href="servlet.html">Configuration for the OLFS servlet is here. </a></p>
<p>&nbsp;</p>
<h3>Part IIIc: Test the OLFS servlet.</h3>
<p>To test/use the server, open a web browser and open the URL: </p>
<blockquote>
  <p> <a href="http://localhost:8080/" class="style1">http://localhost:8080/</a></p>
</blockquote>
<p>and you should see the Tomcat default page. Open the URL:</p>
<blockquote>
  <p class="style1"><a href="http://localhost:8080/opendap/s4/data/nc/fnoc1.nc.das">http://localhost:8080/opendap/s4/</a></p>
</blockquote>
<p>To see an HTML directory of the top of your data archive. </p>
<p>&nbsp;</p>
<p>You can probably 
  get a THREDDS catalog by appending&quot;catalog.html&quot; to the end of any URL that returns an HTML directory, like so: </p>
<blockquote>
  <p> <a href="http://localhost:8080/opendap/s4/catalog.xml" class="style1">http://localhost:8080/opendap/s4/catalog.xml</a><br />
    <a href="http://localhost:8080/opendap/s4/data/catalog.xml" class="style1">http://localhost:8080/opendap/s4/data/catalog.xml</a><br />
    <a href="http://localhost:8080/opendap/s4/data/nc/catalog.xml" class="style1">http://localhost:8080/opendap/s4/data/nc/catalog.xml</a></p>
</blockquote>
<p>Et cetera.</p>
<p>Usage Note:  If you use ctrl-c to stop watching the tail of the servers output, make sure to run bin/shutdown.sh to 
  shutdown Tomcat. If you don't, you may get errors when you next
try to start the Tomcat server.</p>
</body>
</html>
