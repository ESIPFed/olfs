<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
<title>Untitled Document</title>
<style type="text/css">
<!--
.style1 {font-family: "Courier New", Courier, mono}
.style3 {	font-family: "Courier New", Courier, mono;
	font-size: 14px;
}
.style4 {color: #FF0000}
-->
</style>
</head>

<body>
<h1 align="center"><a href="http://www.opendap.org"><img src="images/opendap_logo_masthead.gif" width="206" height="93" border="0" /></a><br />
BES</h1>
<hr />

<p>The reference implentation of the BES is based on the C++ implmentation of the OPeNDAP software. To install the BES you will need to download and installt the BES package . See the <a href="install.html">installation instructions</a> for where to get it and how to install it. </p>
<p>&nbsp;</p>
<h2>The <em>opendap.ini</em> configuration file</h2>
<p>  Once installed the BES will require configuration. This achieved by editing a configuration file called <em class="style1">opendap.ini</em> To point the daemon at the configuration file, set  the environment variabple <strong>OPENDAP_INI</strong> to the full path of the file. For a bash shell that might look like:</p>
<blockquote>
  <p><span class="style3">export OPENDAP_INI =
    /usr/local/Server/config/opendap.ini</span> </p>
</blockquote>
<p>(adjust to reflect your local installation location) </p>
<p>The <em>opendap.ini</em> file is a file that contains key/value pairs used by the OPeNDAP server. </p>
<h3>Server Administrator and Logging</h3>
<p> For the most part you will only need to make only two changes to this file.</p>
<p><span class="style1">OPeNDAP.ServerAdministrator=admin@email.address.for.admin</span></p>
<blockquote>
  <p>The first is to the key <span class="style1">OPeNDAP.ServerAdministrator</span>. This should be set to the email address of the person who will be administrating this OPeNDAP server.</p>
</blockquote>
<p><span class="style1">OPeNDAP.LogName=/usr/local/server4/log/openda.log</span></p>
<blockquote>
  <p>The other key is the <span class="style1">OPeNDAP.LogName</span> key, which defines the full path to the opendap log file. This log file will keep track of what requests are made and whether they are completed. </p>
</blockquote>
<p><span class="style1">OPeNDAP.LogVerbose=no</span></p>
<blockquote>
  <p>Defaults to no, meaning that the system won&rsquo;t dump debug information to the log file. If this key is set to yes then you will see much more information being dumped to the log file. This can be done in order to determine if there is a problem with the server and where it might be having that problem.</p>
</blockquote>
<p>&nbsp;</p>
<h3>Help files</h3>
<p><span class="style1">OPeNDAP.Help.TXT=/usr/local/Server4/bes/dispatch/dispatch_help.txt</span></p>
<p><span class="style1">OPeNDAP.Help.HTTP=/usr/local/Server4/bes/dispatch/dispatch_help.html</span></p>
<p>  There are two help files that contain information that is returned to a user who makes a &lsquo;show help&rsquo; request. One key represents a plain text version of the file while the other represents an html version. The keys are <span class="style1">OPeNDAP.Help.TXT</span> and <span class="style1">OPeNDAP.Help.HTTP</span>. These two files are located in the bes/dispatch directory as part of the BES source distribution. Reference them there, or copy them somwhere else and reference them accordingly. </p>
<p>[<em>By default, the request handler built for you contains code that will likewise read help information for your server from files. Again, one key represents a plain text version of the help information while the other represents an html version. These keys are <span class="style1">&lt;class_prefix&gt;.Help.TXT</span> and<span class="style1"> &lt;class_prefix&gt;.Help.HTTP</span> where <span class="style1">&lt;class_prefix</span>&gt; is the answer to the second question asked by the createServer script. The default location specified in the initialization file is the same as the OPeNDAP help files.</em> <span class="style4">&lt;Patrick said to &quot;Skip that part ... I wrote a script that would generate source code for you in the new bes server format, generate makefiles, configure scripts, source files, etc... It's called createServer and lives in bes/bin and uses template files in bes/templates.&quot; I'm not sure what part I'm to skip. Comments?&gt;</span>]</p>
<h3><em>Buffering</em></h3>
<p>  <span class="style1">OPeNDAP.Info.Buffered=no</span></p>
<blockquote>
  <p>Should the OPeNDAP server buffer requests for help, version and other informational requests? That&rsquo;s what this next key specifies. A value of no means that the information is not buffered and is transmitted as it is added to the informational response object.</p>
</blockquote>
<p class="style1">&nbsp;</p>
<h3>Container persistence</h3>
<p>  <span class="style1">OPeNDAP.Container.Persistence=nice</span></p>
<blockquote>
  <p>What&rsquo;s this you ask? A container represents a set of data. For example, a Cedar file is a container of data, a NetCDF file is a container of data. For the most part, a container will represent a file. When defining a request you specify what containers will be used for that request using a container&rsquo;s symbolic name. What if, when defining a request, the user specifies a container that does not exist? This key defines what to do. The key <span class="style1">OPeNDAP.Container.Persistence</span> can be set to nice, meaning just log a message to the opendap log file, or to strict, which means that the system should throw an error message and stop processing the request. The default set in the initialization file is nice.</p>
</blockquote>
<h3>Controlling memory usage, supporting exceptions, and dynamic memory requirements.</h3>
<p><br />
<span class="style1">OPeNDAP.Memory.GlobalArea.EmergencyPoolSize=1</span></p>
<blockquote>
  <p>The key <span class="style1">OPeNDAP.Memory.GlobalArea.EmergencyPoolSize</span> tells the OPeNDAP server how much memory to reserve for memory exceptions. The fact is that throwing C++ exceptions when memory is exhausted required yet more dynamically allocated memory so this way we have a small memory pool available for exceptions to work if memory ever does run out. The value should be an integer which represents the number of MB to reserve.</p>
</blockquote>
<p><span class="style1">OPeNDAP.Memory.GlobalArea.ControlHeap=no</span></p>
<blockquote>
  <p>The key <span class="style1">OPeNDAP.Memory.GlobalArea.ControlHeap</span> has possible values of {yes,no}. This key tells the OPeNDAP server whether or not you wish to control the maximum heap expansion for an OPeNDAP server processes. In almost 100% of Unix systems, allocating memory expands the heap (if necessary) so even when you free the memory (no leaks) the heap does not get contracted because free marks your memory blocks as available for your process but it does not return such memory to the OS. You can imagine that OPeNDAP server process serving a huge amount of data can try to expand its heap to the point of creating process starvation (assuming the process stays alive after handling the request) to other processes running on the machine. It is suggested to set this value to `yes' if you expect heavy loads, otherwise keep it set to `no'.<br />
    <br />
  If you set the key <span class="style1">OPeNDAP.Memory.GlobalArea.ControlHeap</span> to `yes', then you will need to set the key OPeNDAP.Memory.GlobalArea.MaximunHeapSize. This key tells the OPeNDAP server to expand the process heap to a predetermined value upon initialization. This size remains constant and works in two ways; it assures the server will not take all the memory in your machine and it assures that there is enough memory to work properly. Depending on the size of your containers and the size of the queries you expect to serve (as well as how much memory is available on your machine) you can set this value to an integer between 10 to 400, representing MB.</p>
</blockquote>
<p><span class="style1">OPeNDAP.Memory.GlobalArea.Verbose=yes</span></p>
<blockquote>
  <p>The key <span class="style1">OPeNDAP.Memory.GlobalArea.Verbose</span> has possible values {yes,no}. This key tells the OPeNDAP server to write extra debugging information in the log so developers and administrators can track memory management.</p>
</blockquote>
<h3><br />
Single or multiple client connections at a time</h3>
<p>  <span class="style1">OPeNDAP.ProcessManagerMethod=multiple</span></p>
<blockquote>
  <p>As mentioned in the section OPeNDAP server architecture above, the OPeNDAP server can process a single client connect at a time or multiple client connections at a time. The key <span class="style1">OPeNDAP.ProcessManagerMethod</span> can be set to either <span class="style1">single</span>, which means that only one client can connect at any given time or to <span class="style1">multiple</span>, which means that multiple clients can connect to the server at any one time.</p>
</blockquote>
<h3><br />
Connecting using UNIX sockets</h3>
<p>  <span class="style1">OPeNDAP.ServerUnixSocket=/tmp/opendap.socket</span></p>
<blockquote>
  <p>A client can connect to your server either by specifying a port on the server machine or by using a UNIX socket. The key <span class="style1">OPeNDAP.ServerUnixSocket</span> should be set to the full path of your UNIX socket file. The default is <span class="style1">/tmp/opendap.socket</span>, which should work fine.</p>
</blockquote>
<h3><br />
Connecting with a Browser</h3>
<p>  <span class="style1">OPeNDAP.DefaultResponseMethod=POST</span></p>
<blockquote>
  <p>The key <span class="style1">OPeNDAP.DefaultResponseMethod</span> is for internal use only and should not be set by the user.<br />
  </p>
</blockquote>
<hr />
<h3>Here is an example opendap.ini file:</h3>
<pre class="style1">   #-----------------------OPeNDAP Initialization file---------------------#
   #                                                                       #
   #       National Center for Atmospheric Research (NCAR)                 #
   #       High Altitude Observatory (HAO)                                 #
   #       Key entries for OPeNDAP-g server run time behavior              #
   #                                                                       #
   #-----------------------------------------------------------------------#</pre>
<pre class="style1"># Who is responsable for this server
   OPeNDAP.ServerAdministrator=ADMINISTRATOR_EMAIL</pre>
<pre class="style1"># Where we log the stuff...
   OPeNDAP.LogName=OPENDAP_DIR/opendap.log
   OPeNDAP.LogVerbose=no</pre>
<pre class="style1"># Where the help files are located. These help files are used when a user
   # make a 'show help' request to the server. These first two are specific to
   # the OPeNDAP-g server. The other help keys are for your use.
   OPeNDAP.Help.TXT=OPENDAP_DIR/info/dispatch_help.txt
   OPeNDAP.Help.HTTP=OPENDAP_DIR/info/dispatch_help.html</pre>
<pre class="style1">OPENDAP_CLASS.Help.TXT=OPENDAP_DIR/info/OPENDAP_TYPE_help.txt
   OPENDAP_CLASS.Help.HTTP=OPENDAP_DIR/info/OPENDAP_TYPE_help.html</pre>
<pre class="style1"># Should the OPeNDAP-g server buffer requests for help, version and other
   # informational requests.
   OPeNDAP.Info.Buffered=no</pre>
<pre class="style1"># If the symbolic name cannot be found in persistence, nice means simply log
   # an error, strict means throw an exception
   OPeNDAP.Container.Persistence=strict</pre>
<pre class="style1"># Defines size of system global memory pool. The default values should be
   # good enough for most OPeNDAP-g servers
   OPeNDAP.Memory.GlobalArea.EmergencyPoolSize=1
   OPeNDAP.Memory.GlobalArea.ControlHeap=no
   OPeNDAP.Memory.GlobalArea.MaximunHeapSize=10
   OPeNDAP.Memory.GlobalArea.Verbose=yes</pre>
<pre class="style1"># This key defines is the listener handles client connections. A value of
   # single means that only one client can be connected at any given time. A
   # value of multiple means that multiple clients can connect at any one time
   # and will have their own process space in order to respond to requests.
   OPeNDAP.ProcessManagerMethod=multiple</pre>
<pre class="style1"># Location of the Unix socket for incoming connections.
   OPeNDAP.ServerUnixSocket=/tmp/opendap.socket</pre>
<pre class="style1"># If the client comes from a browser via HTTP this is how we respond
   OPeNDAP.DefaultResponseMethod=POST</pre>
</body>
</html>
